---
# Reduced version of the AWX project_update.yml playbook

- hosts: localhost
  gather_facts: false
  connection: local
  name: Update collections
  tasks:

    - name: fetch galaxy collections
      command: >
        ansible-galaxy collection install awx.awx
        --collections-path /var/lib/awx/projects/collections
        {{ ' -' + 'v' * ansible_verbosity if ansible_verbosity else '' }}
      args:
        chdir: /var/lib/awx/projects/collections
      register: galaxy_collection_result
      changed_when: "'Installing ' in galaxy_collection_result.stdout"
      environment:
        ANSIBLE_FORCE_COLOR: false
        ANSIBLE_COLLECTIONS_PATHS: "/var/lib/awx/projects/collections"
        GIT_SSH_COMMAND: "ssh -o StrictHostKeyChecking=no"

